{% extends "base.html.j2" %}

{% block heading %}Data{% endblock %}

{% block content %}
    	<div class="col-lg-2">

    {% with messages = get_flashed_messages(with_categories=true) %}
		{% for category, message in messages %}
		<p class="alert-{{ category }}">{{ message }}</p>
		{% endfor %}
	{% endwith %}

        <div class="panel panel-default">
			<div class="panel-heading">
            Data Table
			</div>
        
			</div>
			<!-- /.panel-body -->
		</div>
		<!-- /.panel -->
	</div>
	<!-- /.col-lg-12 -->



    <div class="col-lg-12">
        <div class="panel panel-default">

        <div id="loading">
        </div>

        {# <div class="panel-heading">
            DataTables Advanced Tables
        </div>
        <!-- /.panel-heading --> #}
            <div class="panel-body">
                <table width="100%" class="table table-striped table-bordered table-hover" id="data_table">
                    <thead id="thead">
                        <tr>
                        {% for key in cham_df.keys() %}
                            <th>{{ key|safe }}</th>
                        {% endfor %}
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        {% for value in cham_df.items() %}
                        <tr>
                            {# {% for i in range() %}
                            <td>{{ element.value()|safe }}</td>
                            {% endfor %} #}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <!-- /.table-responsive -->
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
   </div>
   <!-- /.col-lg-12 -->



   
    <script>
    
    var $ = function (selector) {
        return document.querySelector(selector);
    };

    var table_present = false;
    console.log(cham_df)

    function DisplayData() {

        if (table_present == true) {

            var table = $('#data_table');

            table.DataTable().destroy();

            $('#thead').empty();
            $('#tbody').empty();


            table_present = false;

        };

        var loading = document.getElementById('loading');
        $('#loading').empty();
        var p = "<p class='alert alert-info'>Loading...</p>";
        loading.innerHTML += p;
        

        if (table_present == false) {
            // onclick stuff
            console.log("id: ", $(this).attr('data-sessionid'));
            sessionid = $(this).attr('data-sessionid');

            $.ajax({
                method: "GET",
                url: "/apis/fetch_data/" + sessionid
            })
            .done(function ( cham_df ) {
                $('#loading').empty();

                console.log('DONE!');

                var thead = document.getElementById('thead');

                var tr = "<tr>";
                for (var i = 0; i < cham_df.keys().length; i++) {
                    tr += "<th>" + cham_df[0][i]
                }

                thead.innerHTML += tr;

                var tbody = document.getElementById('tbody');

                for (var i = 0; i < cham_df.length; i++) {
                    //console.log(jobs[i]);
                    var tr = "<tr>";

                    tr += "<td>" + jobs[i]['username'] + "</td>" 
                    + "<td>" + jobs[i]['description'] + "</td>" 
                    + "<td>" + jobs[i]['start time'] + "</td>" 
                    + "<td><div>"
                        + "</div></td>" 
                    + "<td>" + "<a href='#' type='button' class='btn btn-default'>|Button|</a>" + "</td></tr>";

                    /* We add the table row to the table body */
                    tbody.innerHTML += tr;
                };

                SetUpTable();

                table_present = true

            })
            .fail(function ( response ) {
                
                $('#loading').empty();

                console.log('FAIL!');
                console.log(response.responseText);


                var p = "<p class='alert-warning'>" + response.responseText + "</p>"
                $('#loading').html(p);


            });
        };

    };

    //editbutton.addEventListener("click", function(){console.log(this.id)});
    //delbutton.addEventListener("click", function(){console.log(this.id)});
   
    </script>

{% endblock %}

{% block scripts %}


   <!-- DataTables JavaScript -->
   <script src={{url_for('static', filename="vendor/DataTables-1.10.25/js/jquery.dataTables.js")}}></script>
   {# <script src={{url_for('static', filename="vendor/datatables-plugins/dataTables.bootstrap.js")}}></script> #}
   <script src={{url_for('static', filename="vendor/Responsive-2.2.9/js/dataTables.responsive.js")}}></script>

   <!-- Page-Level Demo Scripts - Tables - Use for reference -->
   <script>
   $(document).ready(function() {
      $('#data_table').DataTable({
         responsive: true
      });
   });
   </script>

{% endblock %}
