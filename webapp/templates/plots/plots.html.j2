{% extends "base.html.j2" %}

{% block heading %}Plots{% endblock %}

{% block content %}

    <div class="panel panel-default">
    <div class="container-fluid" id="dropdowns">

        <h3>Test Plot</h3><br>

        {# <select> tags go here #}

    </div>
    <div class="container">

        {# <img src="data:image/png;base64, {{ plot_url }}"> #}
        <canvas id="myChart" style="display: block; box-sizing: border-box; height: 384px; width: 768px;" width="768" height="384"></canvas>

    </div>
    </div>


    <!-- jQuery -->
    <script src={{url_for('static', filename="vendor/jQuery-3.3.1/jquery-3.3.1.min.js")}}></script>
    <!-- charts.js -->
    <script src={{url_for('static', filename="vendor/chart.js-3.4.1/package/dist/chart.min.js")}}></script>
    <script>

    function generateChart(x_axis, x_data, y_axis, y_data) {
        
        var data = {x: x_data, y: y_data};
        console.log(data);
        
        var ctx = document.getElementById("myChart");

        var myChart = new Chart(ctx, {
        type: 'scatter',
        data: {
            labels: x_data,
            datasets: [{
                label: y_axis,
                data: data
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:false
                    }
                }]
            }
        },
        // Boolean - whether or not the chart should be responsive and resize when the browser does.

        responsive: true,

        // Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container

        maintainAspectRatio: false,
        });

    return myChart;
    };

    $(document).ready(function() {
        var chart = null;
        var df_k = null;
        var df_v = null;
        //var df_rows = null;

        var xaxis = "";
        var xdata = null;
        var yaxis = "";
        var ydata = null;

        var df = {{ cham_df }};

        df_k = Object.keys(df);
        //console.log(df_k)
        df_v = Object.values(df);
        //console.log(df_v)

        axes = ['xaxis', 'yaxis'];
        var dropdown_div = document.getElementById('dropdowns');

        axes.forEach((axis, i) => {
            
            var select = "<select name="+axis+" id="+axis+" class='custom-select custom-select-sm' style='width: 500px; margin-right: 25px; margin-bottom: 15px'>"

            df_k.forEach((element, index) => {
                select += "<option id="+element+" value="+index+">"+element+"</option>";
            });
            select += "</select>"

            dropdown_div.innerHTML += select;
        });

        $("select").each(function(){

            var select = $(this);

            select.change(function () {
                console.log(select.prop('id'),select.val());
                if (select.prop('id') == "xaxis") {
                    xaxis = select.find('option:selected').prop('id');
                    xdata = Object.values(df_v[select.val()]);
                };
                if (select.prop('id') == "yaxis") {
                    yaxis = select.find('option:selected').prop('id');
                    ydata = Object.values(df_v[select.val()]);
                };

                if (chart !== null) {
                    console.log('destroy');
                    chart.destroy();
                    chart = null;
                    $('myChart').empty();
                };
                chart = generateChart(xaxis, xdata, yaxis, ydata);
                //console.log(chart);

            });
        }).trigger('change');


        //chart = generateChart(xaxis, xdata, yaxis, ydata);

    });

    </script>


{% endblock %}